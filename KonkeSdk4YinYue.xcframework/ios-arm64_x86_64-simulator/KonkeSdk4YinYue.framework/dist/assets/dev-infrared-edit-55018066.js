import{_ as y,c as _,b as a,w as f,g as k,v as D,a as m,o as N,p as w,f as g,l as C,e as L}from"./_plugin-vue_export-helper-4dcb9733.js";import"./index-8125559d.js";/* empty css              *//* empty css              */import"./index-290cf1f7.js";import{F as V}from"./index-2fcd576e.js";import{_ as T}from"./nav-bar-7129f874.js";import{R as b}from"./room-component-44c94e63.js";import{S as P}from"./scene-action-light-component-8b8aa1cf.js";import{f as R,p,q as S,t as U,u as h,e as O,v as j,r as x}from"./api-a6d3b59a.js";import{g as A}from"./urlparse-f25d0f77.js";import{a as r}from"./function-call-f34a9b65.js";import{P as E}from"./index-e78e07c2.js";import"./use-route-83ee6a88.js";import"./use-id-0ad1db31.js";import"./use-touch-d5903fe7.js";import"./index-13496d90.js";import"./index-bb17ddfd.js";import"./index-e561a6c4.js";/* empty css              */import"./index-03d292c7.js";import"./index-56f32716.js";import"./index-38ea024d.js";const B={components:{SceneActionLight:P,RoomListPop:b},data(){return{devName:"",room_sel_show:!1,roomList:[],roomName:"",roomId:-1,devId:-1,typeName:"",userDevice:{},rcType:"",codeId:-1,codeType:"self",isNewCode:!0,nodeId:-1,keyList:[{keyId:0,keyName:"POWER",keyValue:"1",learned:!1},{keyId:0,keyName:"CH-",keyValue:"2",learned:!1},{keyId:0,keyName:"CH+",keyValue:"3",learned:!1},{keyId:0,keyName:"VOL-",keyValue:"4",learned:!1},{keyId:0,keyName:"VOL+",keyValue:"5",learned:!1},{keyId:0,keyName:"LEFT",keyValue:"42",learned:!1},{keyId:0,keyName:"UP",keyValue:"43",learned:!1},{keyId:0,keyName:"RIGHT",keyValue:"44",learned:!1},{keyId:0,keyName:"Ok",keyValue:"45",learned:!1},{keyId:0,keyName:"DOWN",keyValue:"46",learned:!1},{keyId:0,keyName:"MENU",keyValue:"23",learned:!1},{keyId:0,keyName:"BACK",keyValue:"55",learned:!1}]}},mounted(){this.getUrlParams(),window.__eventBus.on("infraredLibCode",o=>{console.log(o),this.rcType=o.rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇",this.codeId=o.codeId,this.codeType=o.codeType,this.keyList=o.keyList,this.isNewCode=!0})},methods:{getUrlParams(){let o=window.location.search;const e=A(o);console.log(e),e!=null&&"devId"in e&&(this.devId=e.devId,console.log(this.devId),this.devId!=null&&this.devId!=-1&&this.getDevInfo()),"nodeId"in e&&(this.nodeId=e.nodeId)},getDevInfo(){R({userDeviceId:this.devId}).then(o=>{var e;console.log(o),this.userDevice=o.data.userDeviceList[0],this.roomName=(e=o.data.userDeviceList[0])==null?void 0:e.roomName,this.roomId=o.data.userDeviceList[0].roomId,this.devName=o.data.userDeviceList[0].deviceName,this.userDevice.remoterList!=null&&this.userDevice.remoterList.length!=0&&(this.rcType=JSON.parse(this.use.userExtension).rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇")}).catch(o=>r(o))},onClickLeft(){window.__jsb.pop()},onClickRight(){var o;if(this.devName==""){r("请输入设备名称");return}if(this.roomId==-1){r("请选择房间");return}try{if(this.isNewCode)if(this.codeType=="cloud"){const e={};e.codeId=this.codeId,e.channelId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId,e.isMajor=!0,e.rcType="AC";const i={};i.roomId=this.userDevice.roomId,i.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,i.isMaster=!1,i.remoteList=e,i.deviceName=this.userDevice.deviceName,i.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const n={};n.rcType="AC",i.extension=JSON.stringify(n),console.log("device: ",i),p(i).then(s=>{console.log("createDevice",s),S(this.devId,this.codeId,this.userDevice.nodeId,!1,"AC",this.keyList).then(t=>{U(this.devId,this.codeId,this.nodeId==-1?this.userDevice.nodeId:this.nodeId).then(l=>{h(s.data.userDevice.userDeviceId,this.devName,this.roomId).then(c=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""})})}).catch(l=>{r(l)}),console.log("bindcodelib",s)})}).catch(s=>{console.log("err",s)})}else{console.log("sava codes");const e={};e.roomId=this.userDevice.roomId,e.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,e.isMaster=!1,e.remoterKeysList=this.keyList,e.deviceName=this.userDevice.deviceName,e.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const i={};i.rcType=this.rcType,e.extension=JSON.stringify(i),e.typeId=-1,console.log("device2: ",(o=this.userDevice)==null?void 0:o.UDID),e.udid=this.userDevice.UDID.indexOf("$")!=-1?this.userDevice.UDID:this.userDevice.UDID+"$"+this.nodeId,console.log("device: ",e),p(e).then(n=>{h(n.data.userDevice.userDeviceId,this.devName,this.roomId).then(s=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),O(n.data.userDevice.userDeviceId,this.nodeId==-1?this.userDevice.nodeId:this.nodeId,this.keyList).then(t=>{console.log(t),window.__jsb.pop()}).catch(t=>{r(t)})})}).catch(n=>{console.log("err",n)})}else h(this.devId,this.devName,this.roomId).then(e=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),window.__jsb.pop()})}catch(e){r(e)}},toSelType(){window.__jsb.push({route:"dev-infrared-type",params:{devId:this.devId,nodeId:this.userDevice.nodeId==null?1:this.userDevice.nodeId}})},delDev(){j(this.devId).then(o=>{window.__jsb.forwardEvent({eventName:"reload",eventData:"",fromPage:"devedit",toPage:""}),window.__jsb.pop()}).catch(o=>{r(o)})},selRoom(){this.room_sel_show=!0,x().then(o=>{o.code==200?this.roomList=o.data.roomList:r(o.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(o){console.log("onRoomSelConfirm",o),this.roomName=o.roomName,this.roomId=o.roomId,this.room_sel_show=!1}}},v=o=>(w("data-v-28d44429"),o=o(),g(),o),M={class:"home"},F=v(()=>m("div",{class:"name_hint"}," 设备名称 ",-1)),H=v(()=>m("div",{class:"name_hint"}," 房间 ",-1)),J=v(()=>m("div",{class:"name_hint"}," 红外配置 ",-1));function K(o,e,i,n,s,t){const l=T,c=V,I=C("RoomListPop"),u=E;return N(),_("div",M,[a(l,{class:"nav_bar",title:"编辑设备","right-text":"保存",onClickRight:t.onClickRight,onClickLeft:t.onClickLeft},null,8,["onClickRight","onClickLeft"]),F,a(c,{class:"input",modelValue:s.devName,"onUpdate:modelValue":e[0]||(e[0]=d=>s.devName=d),clearable:"",placeholder:"请输入设备名称"},null,8,["modelValue"]),H,a(c,{class:"input",modelValue:s.roomName,"onUpdate:modelValue":e[1]||(e[1]=d=>s.roomName=d),onClick:t.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),J,a(c,{class:"input",modelValue:s.typeName,"onUpdate:modelValue":e[2]||(e[2]=d=>s.typeName=d),onClick:t.toSelType,"right-icon":"arrow ",readonly:"",placeholder:"请选择红外类型"},null,8,["modelValue","onClick"]),a(u,{show:s.room_sel_show,"onUpdate:show":e[3]||(e[3]=d=>s.room_sel_show=d),position:"bottom"},{default:f(()=>[a(I,{list:s.roomList,onOnCancal:t.onRoomSelCancel,onOnConfirm:t.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),k(m("div",{class:"del_text",onClick:e[4]||(e[4]=(...d)=>t.delDev&&t.delDev(...d))},"删除设备",512),[[D,s.devId!=null&&s.devId!=-1]])])}const W=y(B,[["render",K],["__scopeId","data-v-28d44429"]]);L(W).mount("#root");
