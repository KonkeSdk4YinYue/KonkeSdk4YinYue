import{_ as R,c as l,b as m,a as s,F as g,r as p,w as I,f as N,v as k,o as d,t as _,p as x,e as b,g as y,h as A}from"./_plugin-vue_export-helper-c6b04c4a.js";import"./index-31b7c571.js";/* empty css              */import"./index-7bc1b107.js";import{F as O}from"./index-c30f7602.js";import{_ as D}from"./nav-bar-721d5a93.js";import{R as T,_ as u,a as P}from"./ic_scene_add_action-888c5285.js";import{S as U}from"./scene-action-light-component-164e5297.js";import{i as V,n as j,o as B,r as E}from"./api-c9e9a0cd.js";import{p as f,a as h}from"./scene-cfbe032f.js";import{g as F}from"./urlparse-f25d0f77.js";import{s as r}from"./function-call-8de52e48.js";import{P as M}from"./index-03f6bb18.js";import"./use-route-3612c525.js";import"./use-id-23bdf568.js";import"./use-touch-c5100371.js";import"./index-066b1e6c.js";import"./index-d2ea230b.js";import"./index-7882f3c6.js";/* empty css              */import"./index-8310b73f.js";import"./index-860b8b59.js";import"./index-22da9197.js";import"./dev-image-f6fc399c.js";import"./ic_scene1-0f866639.js";const J=""+new URL("ic_scene_add_trigger-2d8976e0.svg",import.meta.url).href,q=""+new URL("ic_scene_add_limit-64529cf8.svg",import.meta.url).href;const z={components:{SceneActionLight:U,RoomListPop:T},data(){return{scenename:"",item:null,value:0,room_sel_show:!1,roomList:[],roomName:"",roomId:-1,actionList:[],triggerList:[],limitList:[],sceneId:-1}},mounted(){this.getUrlParams(),window.__eventBus.on("addDevAction",i=>{i=f(i),this.actionList.push(i)}),window.__eventBus.on("addTriggerSchedule",i=>{i=h(i),this.triggerList.push(i)}),window.__eventBus.on("addLimitSchedule",i=>{if(this.limitList.length>0){r("只能选择一个时间限制");return}i=h(i),this.limitList.push(i)}),window.__eventBus.on("addTrigger",i=>{i=h(i),this.triggerList.push(i)})},methods:{getUrlParams(){let i=window.location.search;const t=F(i);console.log(t),t!=null&&"sceneId"in t&&(this.sceneId=t.sceneId,console.log(this.sceneId),this.sceneId!=null&&this.sceneId!=-1&&this.getSceneDetail())},getSceneDetail(){V(this.sceneId).then(i=>{if(i.data.sceneList.length>0){this.scenename=i.data.sceneList[0].sceneName,this.roomName=i.data.sceneList[0].roomName,this.roomId=i.data.sceneList[0].roomId,this.actionList=i.data.sceneList[0].actionList,this.actionList.forEach(o=>{o.extension=JSON.parse(o.extension),o=f(o)}),this.triggerList=i.data.sceneList[0].triggerList;let t=null;this.triggerList.forEach(o=>{o=h(o),o.triggerType=="Cycle"&&(this.limitList.push(o),t=o)}),t!=null&&this.triggerList.splice(this.triggerList.indexOf(t),1)}else r(i.info)}).catch(i=>console.log(i))},onClickLeft(){window.__jsb.pop()},onClickRight(){if(this.scenename==""){r("请输入情景名称");return}if(this.roomId==-1){r("请选择房间");return}if(this.triggerList==null||this.triggerList.length==0){r("最少要包含一个触发条件");return}if(this.actionList==null||this.actionList.length==0){r("最少要包含一个动作");return}this.actionList.forEach(o=>{o.extension!=null&&o.extension!="null"&&(o.extension=JSON.stringify(o.extension))});let i=null,t=null;this.triggerList.forEach(o=>{o.triggerType=="Schedule"&&(i=o)}),this.limitList.length>0&&(t=this.limitList[0],this.triggerList.push(t)),this.sceneId==-1?j(this.scenename,"Normal",this.roomId,i,t,this.triggerList,this.actionList).then(o=>{window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o)):B(this.sceneId,this.scenename,"Normal",this.roomId,i,t,this.triggerList,this.actionList).then(o=>{window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o))},selRoom(){this.room_sel_show=!0,E().then(i=>{i.code==200?this.roomList=i.data.roomList:r(i.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(i){console.log("onRoomSelConfirm",i),this.roomName=i.roomName,this.roomId=i.roomId,this.room_sel_show=!1},addAction(){window.__jsb.push({route:"scene-action-type"})},addTrigger(){window.__jsb.push({route:"scene-trigger-type"})},addLimit(){window.__jsb.push({route:"scene-limit-type"})},actionRemove(i){this.actionList.splice(this.actionList.indexOf(i),1)},triggerRemove(i){this.triggerList.splice(this.actionList.indexOf(i),1)},limitRemove(i){this.limitList.splice(this.actionList.indexOf(i),1)}}},n=i=>(x("data-v-7aa68c00"),i=i(),b(),i),G={class:"home"},H={class:"dev_content"},K=n(()=>s("div",{class:"name_hint"}," 场景名称 ",-1)),Q=n(()=>s("div",{class:"name_hint"}," 房间 ",-1)),W=n(()=>s("div",{class:"name_hint"}," 触发条件 ",-1)),X=n(()=>s("div",{class:"name_hint1"}," 满足以下任一条件时触发 ",-1)),Y={class:"action"},Z={class:"action_list"},$=["src"],ii={class:"action_info"},si={class:"action_dev_name"},ti={class:"action_exec_name"},oi=n(()=>s("div",{class:"divider"},null,-1)),ei=n(()=>s("img",{class:"add_action_icon",src:J},null,-1)),ni=n(()=>s("div",{class:"add_action_name"},"添加触发条件",-1)),ci=[ei,ni],ai=n(()=>s("div",{class:"name_hint"}," 限制条件 ",-1)),li=n(()=>s("div",{class:"name_hint1"}," 满足以下任一条件时不触发 ",-1)),di={class:"action"},ri={class:"action_list"},_i=["src"],mi={class:"action_info"},hi={class:"action_dev_name"},gi={class:"action_exec_name"},pi=n(()=>s("div",{class:"divider"},null,-1)),ui=n(()=>s("img",{class:"add_action_icon",src:q},null,-1)),vi=n(()=>s("div",{class:"add_action_name"},"添加限制条件",-1)),Li=[ui,vi],fi=n(()=>s("div",{class:"name_hint"}," 执行动作 ",-1)),wi=n(()=>s("div",{class:"name_hint1"}," 执行对应场景设备 ",-1)),Si={class:"action"},Ci={class:"action_list"},Ri=["src"],Ii={class:"action_info"},Ni={class:"action_dev_name"},ki={class:"action_exec_name"},xi=n(()=>s("div",{class:"divider"},null,-1)),bi=n(()=>s("img",{class:"add_action_icon",src:P},null,-1)),yi=n(()=>s("div",{class:"add_action_name"},"添加执行动作",-1)),Ai=[bi,yi];function Oi(i,t,o,Ti,c,a){const w=D,v=O,S=y("RoomListPop"),C=M;return d(),l("div",G,[m(w,{class:"nav_bar",title:"手动场景","right-text":"保存",onClickRight:a.onClickRight,onClickLeft:a.onClickLeft},null,8,["onClickRight","onClickLeft"]),s("div",H,[K,m(v,{class:"input",modelValue:c.scenename,"onUpdate:modelValue":t[0]||(t[0]=e=>c.scenename=e),clearable:"",placeholder:"请输入场景名称"},null,8,["modelValue"]),Q,m(v,{class:"input",modelValue:c.roomName,"onUpdate:modelValue":t[1]||(t[1]=e=>c.roomName=e),onClick:a.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),W,X,(d(!0),l(g,null,p(c.triggerList,e=>(d(),l("div",Y,[s("div",Z,[s("img",{class:"action_icon",src:e.icon},null,8,$),s("div",ii,[s("div",si,_(e.actionDevShowName),1),s("div",ti,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:u,onClick:t[2]||(t[2]=L=>{a.triggerRemove(c.item)})})]),oi]))),256)),s("div",{class:"add_action",onClick:t[3]||(t[3]=(...e)=>a.addTrigger&&a.addTrigger(...e))},ci),ai,li,(d(!0),l(g,null,p(c.limitList,e=>(d(),l("div",di,[s("div",ri,[s("img",{class:"action_icon",src:e.icon},null,8,_i),s("div",mi,[s("div",hi,_(e.actionDevShowName),1),s("div",gi,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:u,onClick:t[4]||(t[4]=L=>{a.limitRemove(c.item)})})]),pi]))),256)),s("div",{class:"add_action",onClick:t[5]||(t[5]=(...e)=>a.addLimit&&a.addLimit(...e))},Li),fi,wi,(d(!0),l(g,null,p(c.actionList,e=>(d(),l("div",Si,[s("div",Ci,[s("img",{class:"action_icon",src:e.icon},null,8,Ri),s("div",Ii,[s("div",Ni,_(e.actionDevShowName),1),s("div",ki,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:u,onClick:t[6]||(t[6]=L=>a.actionRemove(c.item))})]),xi]))),256)),s("div",{class:"add_action",onClick:t[7]||(t[7]=(...e)=>a.addAction&&a.addAction(...e))},Ai)]),m(C,{show:c.room_sel_show,"onUpdate:show":t[8]||(t[8]=e=>c.room_sel_show=e),position:"bottom"},{default:I(()=>[m(S,{list:c.roomList,onOnCancal:a.onRoomSelCancel,onOnConfirm:a.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),N(s("div",{class:"del_text",onClick:t[9]||(t[9]=(...e)=>i.deleteRoom&&i.deleteRoom(...e))},"删除场景",512),[[k,c.sceneId!=null&&c.sceneId!=-1]])])}const Di=R(z,[["render",Oi],["__scopeId","data-v-7aa68c00"]]);A(Di).mount("#root");
