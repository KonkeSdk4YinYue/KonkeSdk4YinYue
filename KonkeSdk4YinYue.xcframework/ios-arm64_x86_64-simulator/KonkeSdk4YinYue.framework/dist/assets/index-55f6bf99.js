import{m as I,X as Ce,W as E,Y as Q,q as Y,s as j,Z as R,R as V,u as w,$ as se,O as ke,a0 as ue,a as h,v as re,M as me,Q as A,y as z,z as Me,x as Pe,A as P,B as H,a1 as we,G as de,a2 as N,U as ee,w as fe,a3 as Ee,a4 as te}from"./_plugin-vue_export-helper-ae94e834.js";import{u as ve}from"./use-expose-833097fe.js";import{L as Se}from"./index-5198b2b7.js";import{u as pe}from"./use-touch-b8f7fc8d.js";import{H as ne,d as Be}from"./constant-eb256a74.js";import{T as He,a as Ne}from"./index-229bfbdd.js";const[Ve,k,ae]=I("picker"),he=e=>e.find(n=>!n.disabled)||e[0];function Ie(e,n){const t=e[0];if(t){if(Array.isArray(t))return"multiple";if(n.children in t)return"cascade"}return"default"}function W(e,n){n=Q(n,0,e.length);for(let t=n;t<e.length;t++)if(!e[t].disabled)return t;for(let t=n-1;t>=0;t--)if(!e[t].disabled)return t;return 0}const oe=(e,n,t)=>n!==void 0&&!!e.find(i=>i[t.value]===n);function X(e,n,t){const i=e.findIndex(u=>u[t.value]===n),l=W(e,i);return e[l]}function Ye(e,n,t){const i=[];let l={[n.children]:e},u=0;for(;l&&l[n.children];){const m=l[n.children],f=t.value[u];if(l=Ce(f)?X(m,f,n):void 0,!l&&m.length){const r=he(m)[n.value];l=X(m,r,n)}u++,i.push(m)}return i}function _e(e){const{transform:n}=window.getComputedStyle(e),t=n.slice(7,n.length-1).split(", ")[5];return Number(t)}function $e(e){return E({text:"text",value:"value",children:"children"},e)}const le=200,ce=300,Fe=15,[ge,G]=I("picker-column"),be=Symbol(ge);var Re=Y({name:ge,props:{value:j,fields:R(Object),options:V(),readonly:Boolean,allowHtml:Boolean,optionHeight:R(Number),swipeDuration:R(j),visibleOptionNum:R(j)},emits:["change","clickOption"],setup(e,{emit:n,slots:t}){let i,l,u,m,f;const r=w(),x=w(),g=w(0),b=w(0),T=pe(),O=()=>e.options.length,p=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,C=s=>{const v=W(e.options,s),a=-v*e.optionHeight,c=()=>{const d=e.options[v][e.fields.value];d!==e.value&&n("change",d)};i&&a!==g.value?f=c:c(),g.value=a},o=()=>e.readonly||!e.options.length,y=s=>{i||o()||(f=null,b.value=le,C(s),n("clickOption",e.options[s]))},D=s=>Q(Math.round(-s/e.optionHeight),0,O()-1),M=(s,v)=>{const a=Math.abs(s/v);s=g.value+a/.003*(s<0?-1:1);const c=D(s);b.value=+e.swipeDuration,C(c)},S=()=>{i=!1,b.value=0,f&&(f(),f=null)},K=s=>{if(!o()){if(T.start(s),i){const v=_e(x.value);g.value=Math.min(0,v-p())}b.value=0,l=g.value,u=Date.now(),m=l,f=null}},L=s=>{if(o())return;T.move(s),T.isVertical()&&(i=!0,re(s,!0)),g.value=Q(l+T.deltaY.value,-(O()*e.optionHeight),e.optionHeight);const v=Date.now();v-u>ce&&(u=v,m=g.value)},_=()=>{if(o())return;const s=g.value-m,v=Date.now()-u;if(v<ce&&Math.abs(s)>Fe){M(s,v);return}const c=D(g.value);b.value=le,C(c),setTimeout(()=>{i=!1},0)},$=()=>{const s={height:`${e.optionHeight}px`};return e.options.map((v,a)=>{const c=v[e.fields.text],{disabled:d}=v,F=v[e.fields.value],B={role:"button",style:s,tabindex:d?-1:0,class:[G("item",{disabled:d,selected:F===e.value}),v.className],onClick:()=>y(a)},Oe={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:c};return h("li",B,[t.option?t.option(v,a):h("div",Oe,null)])})};return se(be),ve({stopMomentum:S}),ke(()=>{const s=e.options.findIndex(c=>c[e.fields.value]===e.value),a=-W(e.options,s)*e.optionHeight;g.value=a}),ue("touchmove",L,{target:r}),()=>h("div",{ref:r,class:G(),onTouchstartPassive:K,onTouchend:_,onTouchcancel:_},[h("ul",{ref:x,style:{transform:`translate3d(0, ${g.value+p()}px, 0)`,transitionDuration:`${b.value}ms`,transitionProperty:b.value?"all":"none"},class:G("wrapper"),onTransitionend:S},[$()])])}});const[Ae]=I("picker-toolbar"),U={title:String,cancelButtonText:String,confirmButtonText:String},xe=["cancel","confirm","title","toolbar"],Ue=Object.keys(U);var ye=Y({name:Ae,props:U,emits:["confirm","cancel"],setup(e,{emit:n,slots:t}){const i=()=>{if(t.title)return t.title();if(e.title)return h("div",{class:[k("title"),"van-ellipsis"]},[e.title])},l=()=>n("cancel"),u=()=>n("confirm"),m=()=>{const r=e.cancelButtonText||ae("cancel");return h("button",{type:"button",class:[k("cancel"),ne],onClick:l},[t.cancel?t.cancel():r])},f=()=>{const r=e.confirmButtonText||ae("confirm");return h("button",{type:"button",class:[k("confirm"),ne],onClick:u},[t.confirm?t.confirm():r])};return()=>h("div",{class:k("toolbar")},[t.toolbar?t.toolbar():[m(),i(),f()]])}});const[Te,q]=I("picker-group"),De=Symbol(Te),Ke=E({tabs:V(),nextStepText:String},U);Y({name:Te,props:Ke,emits:["confirm","cancel"],setup(e,{emit:n,slots:t}){const i=w(0),{children:l,linkChildren:u}=me(De);u();const m=()=>i.value<e.tabs.length-1&&e.nextStepText,f=()=>{m()?i.value++:n("confirm",l.map(x=>x.confirm()))},r=()=>n("cancel");return()=>{var x;const g=(x=t.default)==null?void 0:x.call(t),b=m()?e.nextStepText:e.confirmButtonText;return h("div",{class:q()},[h(ye,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:b,onConfirm:f,onCancel:r},A(t,xe)),h(He,{active:i.value,"onUpdate:active":T=>i.value=T,class:q("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((T,O)=>h(Ne,{title:T,titleClass:q("tab-title")},{default:()=>[g==null?void 0:g[O]]}))]})])}}});const J=E({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:z(44),showToolbar:Me,swipeDuration:z(1e3),visibleOptionNum:z(6)},U),Le=E({},J,{columns:V(),modelValue:V(),toolbarPosition:Pe("top"),columnsFieldNames:Object});var je=Y({name:Ve,props:Le,emits:["confirm","cancel","change","clickOption","update:modelValue"],setup(e,{emit:n,slots:t}){const i=w(),l=w(e.modelValue.slice(0)),{parent:u}=se(De),{children:m,linkChildren:f}=me(be);f();const r=P(()=>$e(e.columnsFieldNames)),x=P(()=>we(e.optionHeight)),g=P(()=>Ie(e.columns,r.value)),b=P(()=>{const{columns:a}=e;switch(g.value){case"multiple":return a;case"cascade":return Ye(a,r.value,l);default:return[a]}}),T=P(()=>b.value.some(a=>a.length)),O=P(()=>b.value.map((a,c)=>X(a,l.value[c],r.value))),p=P(()=>b.value.map((a,c)=>a.findIndex(d=>d[r.value.value]===l.value[c]))),C=(a,c)=>{if(l.value[a]!==c){const d=l.value.slice(0);d[a]=c,l.value=d}},o=()=>({selectedValues:l.value.slice(0),selectedOptions:O.value,selectedIndexes:p.value}),y=(a,c)=>{C(c,a),g.value==="cascade"&&l.value.forEach((d,F)=>{const B=b.value[F];oe(B,d,r.value)||C(F,B.length?B[0][r.value.value]:void 0)}),ee(()=>{n("change",E({columnIndex:c},o()))})},D=(a,c)=>n("clickOption",E({columnIndex:c,currentOption:a},o())),M=()=>{m.forEach(c=>c.stopMomentum());const a=o();return ee(()=>{n("confirm",a)}),a},S=()=>n("cancel",o()),K=()=>b.value.map((a,c)=>h(Re,{value:l.value[c],fields:r.value,options:a,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:x.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:d=>y(d,c),onClickOption:d=>D(d,c)},{option:t.option})),L=a=>{if(T.value){const c={height:`${x.value}px`},d={backgroundSize:`100% ${(a-x.value)/2}px`};return[h("div",{class:k("mask"),style:d},null),h("div",{class:[Be,k("frame")],style:c},null)]}},_=()=>{const a=x.value*+e.visibleOptionNum,c={height:`${a}px`};return h("div",{ref:i,class:k("columns"),style:c},[K(),L(a)])},$=()=>{if(e.showToolbar&&!u)return h(ye,de(A(e,Ue),{onConfirm:M,onCancel:S}),A(t,xe))};H(b,a=>{a.forEach((c,d)=>{c.length&&!oe(c,l.value[d],r.value)&&C(d,he(c)[r.value.value])})},{immediate:!0});let s;return H(()=>e.modelValue,a=>{!N(a,l.value)&&!N(a,s)&&(l.value=a.slice(0),s=a.slice(0))},{deep:!0}),H(l,a=>{N(a,e.modelValue)||(s=a.slice(0),n("update:modelValue",s))},{immediate:!0}),ue("touchmove",re,{target:i}),ve({confirm:M,getSelectedOptions:()=>O.value}),()=>{var a,c;return h("div",{class:k()},[e.toolbarPosition==="top"?$():null,e.loading?h(Se,{class:k("loading")},null):null,(a=t["columns-top"])==null?void 0:a.call(t),_(),(c=t["columns-bottom"])==null?void 0:c.call(t),e.toolbarPosition==="bottom"?$():null])}}});const ze=fe(je),Ge=E({},J,{modelValue:V(),filter:Function,formatter:{type:Function,default:(e,n)=>n}}),qe=Object.keys(J);function Ze(e,n){if(e<0)return[];const t=Array(e);let i=-1;for(;++i<e;)t[i]=n(i);return t}const Qe=(e,n)=>32-new Date(e,n-1,32).getDate(),Z=(e,n,t,i,l)=>{const u=Ze(n-e+1,m=>{const f=Ee(e+m);return i(t,{text:f,value:f})});return l?l(t,u):u},We=(e,n)=>e.map((t,i)=>{const l=n[i];if(l.length){const u=+l[l.length-1].value;if(+t>u)return String(u)}return t}),ie=new Date().getFullYear(),[Xe]=I("date-picker"),Je=E({},Ge,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ie-10,0,1),validator:te},maxDate:{type:Date,default:()=>new Date(ie+10,11,31),validator:te}});var et=Y({name:Xe,props:Je,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:n,slots:t}){const i=w(e.modelValue),l=()=>{const o=e.minDate.getFullYear(),y=e.maxDate.getFullYear();return Z(o,y,"year",e.formatter,e.filter)},u=o=>o===e.minDate.getFullYear(),m=o=>o===e.maxDate.getFullYear(),f=o=>o===e.minDate.getMonth()+1,r=o=>o===e.maxDate.getMonth()+1,x=o=>{const{minDate:y,columnsType:D}=e,M=D.indexOf(o),S=i.value[M];if(S)return+S;switch(o){case"year":return y.getFullYear();case"month":return y.getMonth()+1;case"day":return y.getDate()}},g=()=>{const o=x("year"),y=u(o)?e.minDate.getMonth()+1:1,D=m(o)?e.maxDate.getMonth()+1:12;return Z(y,D,"month",e.formatter,e.filter)},b=()=>{const o=x("year"),y=x("month"),D=u(o)&&f(y)?e.minDate.getDate():1,M=m(o)&&r(y)?e.maxDate.getDate():Qe(o,y);return Z(D,M,"day",e.formatter,e.filter)},T=P(()=>e.columnsType.map(o=>{switch(o){case"year":return l();case"month":return g();case"day":return b();default:return[]}}));H(i,o=>{N(o,e.modelValue)||n("update:modelValue",o)}),H(()=>e.modelValue,o=>{o=We(o,T.value),N(o,i.value)||(i.value=o)},{immediate:!0});const O=(...o)=>n("change",...o),p=(...o)=>n("cancel",...o),C=(...o)=>n("confirm",...o);return()=>h(ze,de({modelValue:i.value,"onUpdate:modelValue":o=>i.value=o,columns:T.value,onChange:O,onCancel:p,onConfirm:C},A(e,qe)),t)}});const it=fe(et);export{it as D,ze as P,J as p};
