import{s as S,z as C,S as K,au as N,av as B,P as F,B as g,ao as G,v as H,W as U,x,m as j,q as M,u as A,A as Y,a0 as V,N as W,aw as $,ak as q,a as f,K as X,F as Z,X as J,ax as Q,T as ee,U as oe,D as te,E as ne,G as ae,I as se,w as le}from"./_plugin-vue_export-helper-ae94e834.js";import{u as ce}from"./use-expose-833097fe.js";import{u as re}from"./use-touch-b8f7fc8d.js";import{u as ie,O as ue}from"./index-6f826b23.js";import{P as de}from"./on-popup-reopen-34d1e964.js";import{c as fe}from"./interceptor-c174082f.js";import{H as ve}from"./constant-eb256a74.js";const D={show:Boolean,zIndex:S,overlay:C,duration:S,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:K,transitionAppear:Boolean,closeOnClickOverlay:C},be=Object.keys(D);let y=0;const E="van-overflow-hidden";function me(e,t){const a=re(),v="01",n="10",c=s=>{a.move(s);const u=a.deltaY.value>0?n:v,w=G(s.target,e.value),{scrollHeight:m,offsetHeight:I,scrollTop:O}=w;let d="11";O===0?d=I>=m?"00":"01":O+I>=m&&(d="10"),d!=="11"&&a.isVertical()&&!(parseInt(d,2)&parseInt(u,2))&&H(s,!0)},i=()=>{document.addEventListener("touchstart",a.start),document.addEventListener("touchmove",c,{passive:!1}),y||document.body.classList.add(E),y++},r=()=>{y&&(document.removeEventListener("touchstart",a.start),document.removeEventListener("touchmove",c),y--,y||document.body.classList.remove(E))},k=()=>t()&&i(),h=()=>t()&&r();N(k),B(h),F(h),g(t,s=>{s?i():r()})}const ye=U({},D,{round:Boolean,position:x("center"),closeIcon:x("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:x("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[he,T]=j("popup");var Ie=M({name:he,inheritAttrs:!1,props:ye,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:a,slots:v}){let n,c;const i=A(),r=A(),k=ie(()=>e.show||!e.lazyRender),h=Y(()=>{const o={zIndex:i.value};if(J(e.duration)){const l=e.position==="center"?"animationDuration":"transitionDuration";o[l]=`${e.duration}s`}return o}),s=()=>{n||(n=!0,i.value=e.zIndex!==void 0?+e.zIndex:Q(),t("open"))},u=()=>{n&&fe(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},w=o=>{t("clickOverlay",o),e.closeOnClickOverlay&&u()},m=()=>{if(e.overlay)return f(ue,{show:e.show,class:e.overlayClass,zIndex:i.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:w},{default:v["overlay-content"]})},I=o=>{t("clickCloseIcon",o),u()},O=()=>{if(e.closeable)return f(se,{role:"button",tabindex:0,name:e.closeIcon,class:[T("close-icon",e.closeIconPosition),ve],classPrefix:e.iconPrefix,onClick:I},null)},d=()=>t("opened"),L=()=>t("closed"),z=o=>t("keydown",o),_=k(()=>{var o;const{round:l,position:P,safeAreaInsetTop:p,safeAreaInsetBottom:R}=e;return te(f("div",ae({ref:r,style:h.value,role:"dialog",tabindex:0,class:[T({round:l,[P]:P}),{"van-safe-area-top":p,"van-safe-area-bottom":R}],onKeydown:z},a),[(o=v.default)==null?void 0:o.call(v),O()]),[[ne,e.show]])}),b=()=>{const{position:o,transition:l,transitionAppear:P}=e,p=o==="center"?"van-fade":`van-popup-slide-${o}`;return f(ee,{name:l||p,appear:P,onAfterEnter:d,onAfterLeave:L},{default:_})};return g(()=>e.show,o=>{o&&!n&&(s(),a.tabindex===0&&oe(()=>{var l;(l=r.value)==null||l.focus()})),!o&&n&&(n=!1,t("close"))}),ce({popupRef:r}),me(r,()=>e.show&&e.lockScroll),V("popstate",()=>{e.closeOnPopstate&&(u(),c=!1)}),W(()=>{e.show&&s()}),$(()=>{c&&(t("update:show",!0),c=!1)}),B(()=>{e.show&&e.teleport&&(u(),c=!0)}),q(de,()=>e.show),()=>e.teleport?f(X,{to:e.teleport},{default:()=>[m(),b()]}):f(Z,null,[m(),b()])}});const Se=le(Ie);export{Se as P,be as a,D as p};
