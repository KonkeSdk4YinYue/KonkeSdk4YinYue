import{V as H,W as C,a as n,G as D,m as J,a5 as B,a6 as K,q as E,s as Y,Z as $,I as k,a7 as O,X as ee,y as V,x as y,z as I,R as ae,u as te,P as ne,a8 as le,D as oe,E as ie,a9 as re,Q as P,aa as se,w as ce,_ as de,o as ue,j as fe,d as S,ab as me,ac as pe,b as A}from"./_plugin-vue_export-helper-ae94e834.js";import{I as j}from"./index-9cad779b.js";import{L as ve}from"./index-5198b2b7.js";/* empty css              *//* empty css              */import"./index-015663ed.js";import{s as ge}from"./index-ccf833f0.js";import{u as we}from"./use-expose-833097fe.js";import{c as he}from"./interceptor-c174082f.js";import{m as be,u as _e}from"./function-call-d8608672.js";import{C as ye}from"./index-52885be2.js";let U;const Ie={loop:!0,images:[],maxZoom:3,minZoom:1/3,onScale:void 0,onClose:void 0,onChange:void 0,teleport:"body",className:"",showIndex:!0,closeable:!1,closeIcon:"clear",transition:void 0,beforeClose:void 0,overlayStyle:void 0,overlayClass:void 0,startPosition:0,swipeDuration:300,showIndicators:!1,closeOnPopstate:!0,closeIconPosition:"top-right"};function Pe(){({instance:U}=be({setup(){const{state:e,toggle:t}=_e(),l=()=>{e.images=[]};return()=>n(ge,D(e,{onClosed:l,"onUpdate:show":t}),null)}}))}const ke=(e,t=0)=>{if(H)return U||Pe(),e=Array.isArray(e)?{images:e,startPosition:t}:e,U.open(C({},Ie,e)),U},[Ue,r,Ce]=J("uploader");function R(e,t){return new Promise(l=>{if(t==="file"){l();return}const d=new FileReader;d.onload=s=>{l(s.target.result)},t==="dataUrl"?d.readAsDataURL(e):t==="text"&&d.readAsText(e)})}function N(e,t){return B(e).some(l=>l.file?K(t)?t(l.file):l.file.size>+t:!1)}function xe(e,t){const l=[],d=[];return e.forEach(s=>{N(s,t)?d.push(s):l.push(s)}),{valid:l,invalid:d}}const Se=/\.(jpeg|jpg|gif|png|svg|webp|jfif|bmp|dpg|avif)/i,ze=e=>Se.test(e);function M(e){return e.isImage?!0:e.file&&e.file.type?e.file.type.indexOf("image")===0:e.url?ze(e.url):typeof e.content=="string"?e.content.indexOf("data:image")===0:!1}var Le=E({props:{name:Y,item:$(Object),index:Number,imageFit:String,lazyLoad:Boolean,deletable:Boolean,previewSize:[Number,String,Array],beforeDelete:Function},emits:["delete","preview"],setup(e,{emit:t,slots:l}){const d=()=>{const{status:o,message:u}=e.item;if(o==="uploading"||o==="failed"){const b=o==="failed"?n(k,{name:"close",class:r("mask-icon")},null):n(ve,{class:r("loading")},null),m=ee(u)&&u!=="";return n("div",{class:r("mask")},[b,m&&n("div",{class:r("mask-message")},[u])])}},s=o=>{const{name:u,item:b,index:m,beforeDelete:x}=e;o.stopPropagation(),he(x,{args:[b,{name:u,index:m}],done:()=>t("delete")})},p=()=>t("preview"),g=()=>{if(e.deletable&&e.item.status!=="uploading"){const o=l["preview-delete"];return n("div",{role:"button",class:r("preview-delete",{shadow:!o}),tabindex:0,"aria-label":Ce("delete"),onClick:s},[o?o():n(k,{name:"cross",class:r("preview-delete-icon")},null)])}},w=()=>{if(l["preview-cover"]){const{index:o,item:u}=e;return n("div",{class:r("preview-cover")},[l["preview-cover"](C({index:o},u))])}},h=()=>{const{item:o,lazyLoad:u,imageFit:b,previewSize:m}=e;return M(o)?n(j,{fit:b,src:o.content||o.url,class:r("preview-image"),width:Array.isArray(m)?m[0]:m,height:Array.isArray(m)?m[1]:m,lazyLoad:u,onClick:p},{default:w}):n("div",{class:r("file"),style:O(e.previewSize)},[n(k,{class:r("file-icon"),name:"description"},null),n("div",{class:[r("file-name"),"van-ellipsis"]},[o.file?o.file.name:o.url]),w()])};return()=>n("div",{class:r("preview")},[h(),d(),g()])}});const Fe={name:V(""),accept:y("image/*"),capture:String,multiple:Boolean,disabled:Boolean,readonly:Boolean,lazyLoad:Boolean,maxCount:V(1/0),imageFit:y("cover"),resultType:y("dataUrl"),uploadIcon:y("photograph"),uploadText:String,deletable:I,afterRead:Function,showUpload:I,modelValue:ae(),beforeRead:Function,beforeDelete:Function,previewSize:[Number,String,Array],previewImage:I,previewOptions:Object,previewFullImage:I,maxSize:{type:[Number,String,Function],default:1/0}};var Ve=E({name:Ue,props:Fe,emits:["delete","oversize","clickUpload","closePreview","clickPreview","update:modelValue"],setup(e,{emit:t,slots:l}){const d=te(),s=[],p=(a=e.modelValue.length)=>({name:e.name,index:a}),g=()=>{d.value&&(d.value.value="")},w=a=>{if(g(),N(a,e.maxSize))if(Array.isArray(a)){const i=xe(a,e.maxSize);if(a=i.valid,t("oversize",i.invalid,p()),!a.length)return}else{t("oversize",a,p());return}a=se(a),t("update:modelValue",[...e.modelValue,...B(a)]),e.afterRead&&e.afterRead(a,p())},h=a=>{const{maxCount:i,modelValue:f,resultType:c}=e;if(Array.isArray(a)){const v=+i-f.length;a.length>v&&(a=a.slice(0,v)),Promise.all(a.map(_=>R(_,c))).then(_=>{const Q=a.map((W,L)=>{const F={file:W,status:"",message:""};return _[L]&&(F.content=_[L]),F});w(Q)})}else R(a,c).then(v=>{const _={file:a,status:"",message:""};v&&(_.content=v),w(_)})},o=a=>{const{files:i}=a.target;if(e.disabled||!i||!i.length)return;const f=i.length===1?i[0]:[].slice.call(i);if(e.beforeRead){const c=e.beforeRead(f,p());if(!c){g();return}if(re(c)){c.then(v=>{h(v||f)}).catch(g);return}}h(f)};let u;const b=()=>t("closePreview"),m=a=>{if(e.previewFullImage){const i=e.modelValue.filter(M),f=i.map(c=>(c.file&&!c.url&&c.status!=="failed"&&(c.url=URL.createObjectURL(c.file),s.push(c.url)),c.url)).filter(Boolean);u=ke(C({images:f,startPosition:i.indexOf(a),onClose:b},e.previewOptions))}},x=()=>{u&&u.close()},T=(a,i)=>{const f=e.modelValue.slice(0);f.splice(i,1),t("update:modelValue",f),t("delete",a,p(i))},G=(a,i)=>{const f=["imageFit","deletable","previewSize","beforeDelete"],c=C(P(e,f),P(a,f,!0));return n(Le,D({item:a,index:i,onClick:()=>t("clickPreview",a,p(i)),onDelete:()=>T(a,i),onPreview:()=>m(a)},P(e,["name","lazyLoad"]),c),P(l,["preview-cover","preview-delete"]))},Z=()=>{if(e.previewImage)return e.modelValue.map(G)},z=a=>t("clickUpload",a),q=()=>{if(e.modelValue.length>=+e.maxCount)return;const a=e.readonly?null:n("input",{ref:d,type:"file",class:r("input"),accept:e.accept,capture:e.capture,multiple:e.multiple,disabled:e.disabled,onChange:o},null);return l.default?n("div",{class:r("input-wrapper"),onClick:z},[l.default(),a]):oe(n("div",{class:r("upload",{readonly:e.readonly}),style:O(e.previewSize),onClick:z},[n(k,{name:e.uploadIcon,class:r("upload-icon")},null),e.uploadText&&n("span",{class:r("upload-text")},[e.uploadText]),a]),[[ie,e.showUpload]])},X=()=>{d.value&&!e.disabled&&d.value.click()};return ne(()=>{s.forEach(a=>URL.revokeObjectURL(a))}),we({chooseFile:X,closeImagePreview:x}),le(()=>e.modelValue),()=>n("div",{class:r()},[n("div",{class:r("wrapper",{disabled:e.disabled})},[Z(),q()])])}});const Ae=ce(Ve);const Re=""+new URL("publish_add_icon-fd1fe317.svg",import.meta.url).href,De=""+new URL("publish_delete_icon-564bb1e1.svg",import.meta.url).href;const Be={props:{previewImage:{type:Boolean,default:!0},UploaderSize:{type:String,default:"calc((100vw - 56px) / 3)"},UploaderUploadBackground:{type:String,default:"#EEEEEE"},customer:{type:Boolean,default:!1}},data(){return{PubAddIcon:Re,PubDeleteIcon:De,fileList:[],themeVars:{UploaderSize:this.UploaderSize,UploaderUploadBackground:this.UploaderUploadBackground,UploaderDeleteIconSize:"20px"}}},methods:{async pickImage(){const{url:e}=await __jsb.pickImage();console.log(e,"pickImage"),this.fileList.push({url:e}),this.$emit("change",this.fileList)}}},Ee={class:"publish-delete"},Oe={class:"publish-delete-s"};function je(e,t,l,d,s,p){const g=j,w=Ae,h=ye;return ue(),fe(h,{"theme-vars":s.themeVars},{default:S(()=>[n(w,{class:"publish-upload",modelValue:s.fileList,"onUpdate:modelValue":t[0]||(t[0]=o=>s.fileList=o),"upload-icon":s.PubAddIcon,multiple:"","max-count":"9","image-fit":"cover",readonly:"",previewImage:l.previewImage,onClickUpload:p.pickImage},me({"preview-delete":S(()=>[A("div",Ee,[A("div",Oe,[n(g,{src:s.PubDeleteIcon,width:"10px",height:"10px"},null,8,["src"])])])]),_:2},[l.customer?{name:"default",fn:S(()=>[pe(e.$slots,"default",{},void 0,!0)]),key:"0"}:void 0]),1032,["modelValue","upload-icon","previewImage","onClickUpload"])]),_:3},8,["theme-vars"])}const Ke=de(Be,[["render",je],["__scopeId","data-v-644c0ef1"]]);export{Re as P,Ke as _,De as a};
