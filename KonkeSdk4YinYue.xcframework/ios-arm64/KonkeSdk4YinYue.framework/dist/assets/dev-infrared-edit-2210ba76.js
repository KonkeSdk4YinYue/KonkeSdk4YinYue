import{_,c as f,b as c,w as D,g as w,v as g,a as m,o as y,p as N,f as C,l as L,e as b}from"./_plugin-vue_export-helper-4dcb9733.js";import"./index-911a1983.js";/* empty css              *//* empty css              */import"./index-9db9ef38.js";import{F as T}from"./index-bb138b09.js";import{_ as k}from"./nav-bar-2d16eeee.js";import{R as S}from"./room-component-52a02669.js";import{S as P}from"./scene-action-light-component-6526c0e0.js";import{f as R,p,q as U,t as V,u as h,e as j,v as x,r as A}from"./api-8276f17b.js";import{g as O}from"./urlparse-f25d0f77.js";import{a as r}from"./function-call-fc609343.js";import{P as E}from"./index-bc3726e2.js";import"./use-route-83ee6a88.js";import"./use-id-0ad1db31.js";import"./use-touch-3e361956.js";import"./index-ace21828.js";import"./index-682de388.js";import"./index-8ce22637.js";/* empty css              */import"./index-76618d4d.js";import"./index-72d5441f.js";import"./index-16a23f12.js";const B={components:{SceneActionLight:P,RoomListPop:S},data(){return{devName:"",room_sel_show:!1,roomList:[],roomName:"",roomId:-1,devId:-1,typeName:"",userDevice:{},rcType:"",codeId:-1,codeType:"",isNewCode:!1,nodeId:-1,keyList:[]}},mounted(){this.getUrlParams(),window.__eventBus.on("infraredLibCode",o=>{console.log(o),this.rcType=o.rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇",this.codeId=o.codeId,this.codeType=o.codeType,this.keyList=o.keyList,this.isNewCode=!0})},methods:{getUrlParams(){let o=window.location.search;const e=O(o);console.log(e),e!=null&&"devId"in e&&(this.devId=e.devId,console.log(this.devId),this.devId!=null&&this.devId!=-1&&this.getDevInfo()),"nodeId"in e&&(this.nodeId=e.nodeId)},getDevInfo(){R({userDeviceId:this.devId}).then(o=>{var e;console.log(o),this.userDevice=o.data.userDeviceList[0],this.roomName=(e=o.data.userDeviceList[0])==null?void 0:e.roomName,this.roomId=o.data.userDeviceList[0].roomId,this.devName=o.data.userDeviceList[0].deviceName,this.userDevice.remoterList!=null&&this.userDevice.remoterList.length!=0&&(this.rcType=JSON.parse(this.use.userExtension).rcType,this.typeName=this.rcType=="AC"?"空调":this.rcType=="TV"?"电视":"风扇")}).catch(o=>r(o))},onClickLeft(){window.__jsb.pop()},onClickRight(){var o;if(this.devName==""){r("请输入设备名称");return}if(this.roomId==-1){r("请选择房间");return}try{if(this.isNewCode)if(this.codeType=="cloud"){const e={};e.codeId=this.codeId,e.channelId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId,e.isMajor=!0,e.rcType="AC";const i={};i.roomId=this.userDevice.roomId,i.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,i.isMaster=!1,i.remoteList=e,i.deviceName=this.userDevice.deviceName,i.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const n={};n.rcType="AC",i.extension=JSON.stringify(n),console.log("device: ",i),p(i).then(s=>{console.log("createDevice",s),U(this.devId,this.codeId,this.userDevice.nodeId,!1,"AC",this.keyList).then(t=>{V(this.devId,this.codeId,this.nodeId==-1?this.userDevice.nodeId:this.nodeId).then(a=>{h(s.data.userDevice.userDeviceId,this.devName,this.roomId).then(l=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""})})}).catch(a=>{r(a)}),console.log("bindcodelib",s)})}).catch(s=>{console.log("err",s)})}else{console.log("sava codes");const e={};e.roomId=this.userDevice.roomId,e.parentDeviceId=this.nodeId==-1?this.userDevice.parentUserDeviceId:this.devId,e.isMaster=!1,e.remoterKeysList=this.keyList,e.deviceName=this.userDevice.deviceName,e.nodeId=this.nodeId==-1?this.userDevice.nodeId:this.nodeId;const i={};i.rcType=this.rcType,e.extension=JSON.stringify(i),e.typeId=-1,console.log("device2: ",(o=this.userDevice)==null?void 0:o.UDID),e.udid=this.userDevice.UDID.indexOf("$")!=-1?this.userDevice.UDID:this.userDevice.UDID+"$"+this.nodeId,console.log("device: ",e),p(e).then(n=>{h(n.data.userDevice.userDeviceId,this.devName,this.roomId).then(s=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),j(n.data.userDevice.userDeviceId,this.nodeId==-1?this.userDevice.nodeId:this.nodeId,this.keyList).then(t=>{console.log(t),window.__jsb.pop()}).catch(t=>{r(t)})})}).catch(n=>{console.log("err",n)})}else h(this.devId,this.devName,this.roomId).then(e=>{window.__jsb.forwardEvent({eventName:"reload",fromPage:"devedit",toPage:""}),window.__jsb.pop()})}catch(e){r(e)}},toSelType(){window.__jsb.push({route:"dev-infrared-type",params:{devId:this.devId,nodeId:this.userDevice.nodeId==null?1:this.userDevice.nodeId}})},delDev(){x(this.devId).then(o=>{window.__jsb.forwardEvent({eventName:"reload",eventData:"",fromPage:"devedit",toPage:""}),window.__jsb.pop()}).catch(o=>{r(o)})},selRoom(){this.room_sel_show=!0,A().then(o=>{o.code==200?this.roomList=o.data.roomList:r(o.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(o){console.log("onRoomSelConfirm",o),this.roomName=o.roomName,this.roomId=o.roomId,this.room_sel_show=!1}}},v=o=>(N("data-v-f6ea8b04"),o=o(),C(),o),J={class:"home"},M=v(()=>m("div",{class:"name_hint"}," 设备名称 ",-1)),F=v(()=>m("div",{class:"name_hint"}," 房间 ",-1)),q=v(()=>m("div",{class:"name_hint"}," 红外配置 ",-1));function K(o,e,i,n,s,t){const a=k,l=T,I=L("RoomListPop"),u=E;return y(),f("div",J,[c(a,{class:"nav_bar",title:"编辑设备","right-text":"保存",onClickRight:t.onClickRight,onClickLeft:t.onClickLeft},null,8,["onClickRight","onClickLeft"]),M,c(l,{class:"input",modelValue:s.devName,"onUpdate:modelValue":e[0]||(e[0]=d=>s.devName=d),clearable:"",placeholder:"请输入设备名称"},null,8,["modelValue"]),F,c(l,{class:"input",modelValue:s.roomName,"onUpdate:modelValue":e[1]||(e[1]=d=>s.roomName=d),onClick:t.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),q,c(l,{class:"input",modelValue:s.typeName,"onUpdate:modelValue":e[2]||(e[2]=d=>s.typeName=d),onClick:t.toSelType,"right-icon":"arrow ",readonly:"",placeholder:"请选择红外类型"},null,8,["modelValue","onClick"]),c(u,{show:s.room_sel_show,"onUpdate:show":e[3]||(e[3]=d=>s.room_sel_show=d),position:"bottom"},{default:D(()=>[c(I,{list:s.roomList,onOnCancal:t.onRoomSelCancel,onOnConfirm:t.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),w(m("div",{class:"del_text",onClick:e[4]||(e[4]=(...d)=>t.delDev&&t.delDev(...d))},"删除设备",512),[[g,s.devId!=null&&s.devId!=-1]])])}const z=_(B,[["render",K],["__scopeId","data-v-f6ea8b04"]]);b(z).mount("#root");
