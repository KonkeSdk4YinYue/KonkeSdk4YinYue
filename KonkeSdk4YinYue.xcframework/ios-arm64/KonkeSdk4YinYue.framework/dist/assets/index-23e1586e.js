import{c as V,z as ye,e as p,a4 as F,n as G,X as A,m as B,b as ce,G as ie,F as se,H as ee,u as ue,p as U,j as O,t as pe,a as Se,a0 as Pe,a6 as M,a7 as Ee,w as re,a8 as me}from"./index-48d5ec75.js";import{a as He,u as de}from"./use-touch-5cae3072.js";import{L as Ie}from"./index-85a17d82.js";import{g as D,q as y,s as x,N as we,b as v,H as N,h as te,m as fe}from"./_plugin-vue_export-helper-b237bda9.js";import{T as Me,a as Ne}from"./index-e42d5b3f.js";const[Be,C,ne]=V("picker"),ve=e=>e.find(o=>!o.disabled)||e[0];function Ve(e,o){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(o.children in n)return"cascade"}return"default"}function J(e,o){o=F(o,0,e.length);for(let n=o;n<e.length;n++)if(!e[n].disabled)return n;for(let n=o-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const oe=(e,o,n)=>o!==void 0&&!!e.find(i=>i[n.value]===o);function Q(e,o,n){const i=e.findIndex(r=>r[n.value]===o),l=J(e,i);return e[l]}function De(e,o,n){const i=[];let l={[o.children]:e},r=0;for(;l&&l[o.children];){const m=l[o.children],f=n.value[r];if(l=ye(f)?Q(m,f,o):void 0,!l&&m.length){const c=ve(m)[o.value];l=Q(m,c,o)}r++,i.push(m)}return i}function _e(e){const{transform:o}=window.getComputedStyle(e),n=o.slice(7,o.length-1).split(", ")[5];return Number(n)}function $e(e){return p({text:"text",value:"value",children:"children"},e)}const ae=200,le=300,Re=15,[he,q]=V("picker-column"),ge=Symbol(he);var Ae=D({name:he,props:{value:G,fields:A(Object),options:B(),readonly:Boolean,allowHtml:Boolean,optionHeight:A(Number),swipeDuration:A(G),visibleOptionNum:A(G)},emits:["change","clickOption","scrollInto"],setup(e,{emit:o,slots:n}){let i,l,r,m,f;const c=y(),h=y(),d=y(0),g=y(0),b=He(),S=()=>e.options.length,_=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,P=u=>{const t=J(e.options,u),a=-t*e.optionHeight,s=()=>{const k=e.options[t][e.fields.value];k!==e.value&&o("change",k)};i&&a!==d.value?f=s:s(),d.value=a},T=()=>e.readonly||!e.options.length,Y=u=>{i||T()||(f=null,g.value=ae,P(u),o("clickOption",e.options[u]))},E=u=>F(Math.round(-u/e.optionHeight),0,S()-1),$=x(()=>E(d.value)),j=(u,t)=>{const a=Math.abs(u/t);u=d.value+a/.003*(u<0?-1:1);const s=E(u);g.value=+e.swipeDuration,P(s)},R=()=>{i=!1,g.value=0,f&&(f(),f=null)},L=u=>{if(!T()){if(b.start(u),i){const t=_e(h.value);d.value=Math.min(0,t-_())}g.value=0,l=d.value,r=Date.now(),m=l,f=null}},z=u=>{if(T())return;b.move(u),b.isVertical()&&(i=!0,se(u,!0));const t=F(l+b.deltaY.value,-(S()*e.optionHeight),e.optionHeight),a=E(t);a!==$.value&&o("scrollInto",e.options[a]),d.value=t;const s=Date.now();s-r>le&&(r=s,m=t)},I=()=>{if(T())return;const u=d.value-m,t=Date.now()-r;if(t<le&&Math.abs(u)>Re){j(u,t);return}const s=E(d.value);g.value=ae,P(s),setTimeout(()=>{i=!1},0)},H=()=>{const u={height:`${e.optionHeight}px`};return e.options.map((t,a)=>{const s=t[e.fields.text],{disabled:k}=t,w=t[e.fields.value],Ce={role:"button",style:u,tabindex:k?-1:0,class:[q("item",{disabled:k,selected:w===e.value}),t.className],onClick:()=>Y(a)},ke={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:s};return v("li",Ce,[n.option?n.option(t,a):v("div",ke,null)])})};return ce(ge),de({stopMomentum:R}),we(()=>{const u=e.options.findIndex(s=>s[e.fields.value]===e.value),a=-J(e.options,u)*e.optionHeight;d.value=a}),ie("touchmove",z,{target:c}),()=>v("div",{ref:c,class:q(),onTouchstartPassive:L,onTouchend:I,onTouchcancel:I},[v("ul",{ref:h,style:{transform:`translate3d(0, ${d.value+_()}px, 0)`,transitionDuration:`${g.value}ms`,transitionProperty:g.value?"all":"none"},class:q("wrapper"),onTransitionend:R},[H()])])}});const[Fe]=V("picker-toolbar"),K={title:String,cancelButtonText:String,confirmButtonText:String},be=["cancel","confirm","title","toolbar"],Ue=Object.keys(K);var Te=D({name:Fe,props:K,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const i=()=>{if(n.title)return n.title();if(e.title)return v("div",{class:[C("title"),"van-ellipsis"]},[e.title])},l=()=>o("cancel"),r=()=>o("confirm"),m=()=>{const c=e.cancelButtonText||ne("cancel");return v("button",{type:"button",class:[C("cancel"),ee],onClick:l},[n.cancel?n.cancel():c])},f=()=>{const c=e.confirmButtonText||ne("confirm");return v("button",{type:"button",class:[C("confirm"),ee],onClick:r},[n.confirm?n.confirm():c])};return()=>v("div",{class:C("toolbar")},[n.toolbar?n.toolbar():[m(),i(),f()]])}});const[xe,X]=V("picker-group"),Oe=Symbol(xe),Ke=p({tabs:B(),nextStepText:String},K);D({name:xe,props:Ke,emits:["confirm","cancel"],setup(e,{emit:o,slots:n}){const i=y(0),{children:l,linkChildren:r}=ue(Oe);r();const m=()=>i.value<e.tabs.length-1&&e.nextStepText,f=()=>{m()?i.value++:o("confirm",l.map(h=>h.confirm()))},c=()=>o("cancel");return()=>{var h;const d=(h=n.default)==null?void 0:h.call(n),g=m()?e.nextStepText:e.confirmButtonText;return v("div",{class:X()},[v(Te,{title:e.title,cancelButtonText:e.cancelButtonText,confirmButtonText:g,onConfirm:f,onCancel:c},U(n,be)),v(Me,{active:i.value,"onUpdate:active":b=>i.value=b,class:X("tabs"),shrink:!0,animated:!0,lazyRender:!1},{default:()=>[e.tabs.map((b,S)=>v(Ne,{title:b,titleClass:X("tab-title")},{default:()=>[d==null?void 0:d[S]]}))]})])}}});const W=p({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:O(44),showToolbar:pe,swipeDuration:O(1e3),visibleOptionNum:O(6)},K),Ye=p({},W,{columns:B(),modelValue:B(),toolbarPosition:Se("top"),columnsFieldNames:Object});var je=D({name:Be,props:Ye,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:o,slots:n}){const i=y(),l=y(e.modelValue.slice(0)),{parent:r}=ce(Oe),{children:m,linkChildren:f}=ue(ge);f();const c=x(()=>$e(e.columnsFieldNames)),h=x(()=>Pe(e.optionHeight)),d=x(()=>Ve(e.columns,c.value)),g=x(()=>{const{columns:t}=e;switch(d.value){case"multiple":return t;case"cascade":return De(t,c.value,l);default:return[t]}}),b=x(()=>g.value.some(t=>t.length)),S=x(()=>g.value.map((t,a)=>Q(t,l.value[a],c.value))),_=x(()=>g.value.map((t,a)=>t.findIndex(s=>s[c.value.value]===l.value[a]))),P=(t,a)=>{if(l.value[t]!==a){const s=l.value.slice(0);s[t]=a,l.value=s}},T=()=>({selectedValues:l.value.slice(0),selectedOptions:S.value,selectedIndexes:_.value}),Y=(t,a)=>{P(a,t),d.value==="cascade"&&l.value.forEach((s,k)=>{const w=g.value[k];oe(w,s,c.value)||P(k,w.length?w[0][c.value.value]:void 0)}),te(()=>{o("change",p({columnIndex:a},T()))})},E=(t,a)=>{const s={columnIndex:a,currentOption:t};o("clickOption",p(T(),s)),o("scrollInto",s)},$=()=>{m.forEach(a=>a.stopMomentum());const t=T();return te(()=>{o("confirm",t)}),t},j=()=>o("cancel",T()),R=()=>g.value.map((t,a)=>v(Ae,{value:l.value[a],fields:c.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:h.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:s=>Y(s,a),onClickOption:s=>E(s,a),onScrollInto:s=>{o("scrollInto",{currentOption:s,columnIndex:a})}},{option:n.option})),L=t=>{if(b.value){const a={height:`${h.value}px`},s={backgroundSize:`100% ${(t-h.value)/2}px`};return[v("div",{class:C("mask"),style:s},null),v("div",{class:[Ee,C("frame")],style:a},null)]}},z=()=>{const t=h.value*+e.visibleOptionNum,a={height:`${t}px`};return v("div",{ref:i,class:C("columns"),style:a},[R(),L(t)])},I=()=>{if(e.showToolbar&&!r)return v(Te,fe(U(e,Ue),{onConfirm:$,onCancel:j}),U(n,be))};N(g,t=>{t.forEach((a,s)=>{a.length&&!oe(a,l.value[s],c.value)&&P(s,ve(a)[c.value.value])})},{immediate:!0});let H;return N(()=>e.modelValue,t=>{!M(t,l.value)&&!M(t,H)&&(l.value=t.slice(0),H=t.slice(0))},{deep:!0}),N(l,t=>{M(t,e.modelValue)||(H=t.slice(0),o("update:modelValue",H))},{immediate:!0}),ie("touchmove",se,{target:i}),de({confirm:$,getSelectedOptions:()=>S.value}),()=>{var t,a;return v("div",{class:C()},[e.toolbarPosition==="top"?I():null,e.loading?v(Ie,{class:C("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),z(),(a=n["columns-bottom"])==null?void 0:a.call(n),e.toolbarPosition==="bottom"?I():null])}}});const Le=re(je),ze=p({},W,{modelValue:B(),filter:Function,formatter:{type:Function,default:(e,o)=>o}}),Ge=Object.keys(W);function qe(e,o){if(e<0)return[];const n=Array(e);let i=-1;for(;++i<e;)n[i]=o(i);return n}const Z=(e,o,n,i,l)=>{const r=qe(o-e+1,m=>{const f=me(e+m);return i(n,{text:f,value:f})});return l?l(n,r):r},Xe=(e,o)=>e.map((n,i)=>{const l=o[i];if(l.length){const r=+l[0].value,m=+l[l.length-1].value;return me(F(+n,r,m))}return n}),[Ze]=V("time-picker"),Je=p({},ze,{minHour:O(0),maxHour:O(23),minMinute:O(0),maxMinute:O(59),minSecond:O(0),maxSecond:O(59),columnsType:{type:Array,default:()=>["hour","minute"]}});var Qe=D({name:Ze,props:Je,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:o,slots:n}){const i=y(e.modelValue),l=x(()=>e.columnsType.map(c=>{const{filter:h,formatter:d}=e;switch(c){case"hour":return Z(+e.minHour,+e.maxHour,c,d,h);case"minute":return Z(+e.minMinute,+e.maxMinute,c,d,h);case"second":return Z(+e.minSecond,+e.maxSecond,c,d,h);default:return[]}}));N(i,c=>{M(c,e.modelValue)||o("update:modelValue",c)}),N(()=>e.modelValue,c=>{c=Xe(c,l.value),M(c,i.value)||(i.value=c)},{immediate:!0});const r=(...c)=>o("change",...c),m=(...c)=>o("cancel",...c),f=(...c)=>o("confirm",...c);return()=>v(Le,fe({modelValue:i.value,"onUpdate:modelValue":c=>i.value=c,columns:l.value,onChange:r,onCancel:m,onConfirm:f},U(e,Ge)),n)}});const at=re(Qe);export{at as T};
