import{_ as I,c as d,a as m,f as i,F as p,r as u,w as R,h as b,v as N,o as r,t as _,p as k,e as x,i as y,g as j}from"./_plugin-vue_export-helper-4adca727.js";import"./index-f4bb52ea.js";/* empty css              */import"./index-f891a278.js";import{F as A}from"./index-62ed2467.js";import{_ as O}from"./nav-bar-94bf83b0.js";import{R as D}from"./room-component-84d679f4.js";import{S as T}from"./scene-action-light-component-1dad52c5.js";import{p as E,m as P,u as U,v as V,r as B}from"./api-61c15ffa.js";import{p as L,a as h}from"./scene-cfbe032f.js";import{g as F}from"./urlparse-f25d0f77.js";import{_ as g,a as M}from"./ic_scene_add_action-3488ce3c.js";import{a as l}from"./function-call-38737c8a.js";import{P as J}from"./index-d76ffcb6.js";import"./use-route-710f3c49.js";import"./use-id-f8db432d.js";import"./use-expose-f66499b2.js";import"./index-72aa8aef.js";import"./index-c18c9d52.js";import"./index-12218a2e.js";/* empty css              */import"./index-3866edd4.js";import"./use-touch-330ddaa2.js";import"./index-d761a1b1.js";import"./index-08ecd083.js";import"./dev-image-f6fc399c.js";import"./ic_scene1-0f866639.js";const q=""+new URL("ic_scene_add_trigger-2d8976e0.svg",import.meta.url).href,z=""+new URL("ic_scene_add_limit-64529cf8.svg",import.meta.url).href;const G={components:{SceneActionLight:T,RoomListPop:D},data(){return{scenename:"",item:null,value:0,room_sel_show:!1,roomList:[],roomName:"",roomId:-1,actionList:[],triggerList:[],limitList:[],sceneId:-1}},mounted(){this.getUrlParams(),window.__eventBus.on("addDevAction",s=>{s=L(s),this.actionList.push(s)}),window.__eventBus.on("addTriggerSchedule",s=>{s=h(s),this.triggerList.push(s)}),window.__eventBus.on("addLimitSchedule",s=>{if(this.limitList.length>0){l("只能选择一个时间限制");return}s=h(s),this.limitList.push(s)}),window.__eventBus.on("addTrigger",s=>{s=h(s),this.triggerList.push(s)})},methods:{delScene(){E(this.sceneId).then(s=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop()}).catch(s=>{l(s)})},getUrlParams(){let s=window.location.search;const t=F(s);console.log(t),t!=null&&"sceneId"in t&&(this.sceneId=t.sceneId,console.log(this.sceneId),this.sceneId!=null&&this.sceneId!=-1&&this.getSceneDetail())},getSceneDetail(){P(this.sceneId).then(s=>{if(s.data.sceneList.length>0){this.scenename=s.data.sceneList[0].sceneName,this.roomName=s.data.sceneList[0].roomName,this.roomId=s.data.sceneList[0].roomId,this.actionList=s.data.sceneList[0].actionList,this.actionList.forEach(o=>{o.extension=JSON.parse(o.extension),o=L(o)}),this.triggerList=s.data.sceneList[0].triggerList;let t=null;this.triggerList.forEach(o=>{o=h(o),o.triggerType=="Cycle"&&(this.limitList.push(o),t=o)}),t!=null&&this.triggerList.splice(this.triggerList.indexOf(t),1)}else l(s.info)}).catch(s=>console.log(s))},onClickLeft(){window.__jsb.pop()},onClickRight(){if(this.scenename==""){l("请输入情景名称");return}if(this.roomId==-1){l("请选择房间");return}if(this.triggerList==null||this.triggerList.length==0){l("最少要包含一个触发条件");return}if(this.actionList==null||this.actionList.length==0){l("最少要包含一个动作");return}this.actionList.forEach(o=>{o.extension!=null&&o.extension!="null"&&(o.extension=JSON.stringify(o.extension))});let s=null,t=null;this.triggerList.forEach(o=>{o.triggerType=="Schedule"&&(s=o)}),this.limitList.length>0&&(t=this.limitList[0],this.triggerList.push(t)),this.sceneId==-1?U(this.scenename,"Normal",this.roomId,s,t,this.triggerList,this.actionList).then(o=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o)):V(this.sceneId,this.scenename,"Normal",this.roomId,s,t,this.triggerList,this.actionList).then(o=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o))},selRoom(){this.room_sel_show=!0,B().then(s=>{s.code==200?this.roomList=s.data.roomList:l(s.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(s){console.log("onRoomSelConfirm",s),this.roomName=s.roomName,this.roomId=s.roomId,this.room_sel_show=!1},addAction(){window.__jsb.push({route:"scene-action-type",params:{type:"auto"}})},addTrigger(){window.__jsb.push({route:"scene-trigger-type"})},addLimit(){window.__jsb.push({route:"scene-limit-type"})},actionRemove(s){this.actionList.splice(this.actionList.indexOf(s),1)},triggerRemove(s){this.triggerList.splice(this.actionList.indexOf(s),1)},limitRemove(s){this.limitList.splice(this.actionList.indexOf(s),1)}}},n=s=>(k("data-v-b562bd29"),s=s(),x(),s),H={class:"home"},K={class:"dev_content"},Q=n(()=>i("div",{class:"name_hint"}," 场景名称 ",-1)),W=n(()=>i("div",{class:"name_hint"}," 房间 ",-1)),X=n(()=>i("div",{class:"name_hint"}," 触发条件 ",-1)),Y=n(()=>i("div",{class:"name_hint1"}," 满足以下任一条件时触发 ",-1)),Z={class:"action"},$={class:"action_list"},ss=["src"],is={class:"action_info"},ts={class:"action_dev_name"},os={class:"action_exec_name"},es=n(()=>i("div",{class:"divider"},null,-1)),ns=n(()=>i("img",{class:"add_action_icon",src:q},null,-1)),cs=n(()=>i("div",{class:"add_action_name"},"添加触发条件",-1)),as=[ns,cs],ls=n(()=>i("div",{class:"name_hint"}," 限制条件 ",-1)),ds=n(()=>i("div",{class:"name_hint1"}," 满足以下任一条件时不触发 ",-1)),rs={class:"action"},_s={class:"action_list"},ms=["src"],hs={class:"action_info"},ps={class:"action_dev_name"},us={class:"action_exec_name"},gs=n(()=>i("div",{class:"divider"},null,-1)),vs=n(()=>i("img",{class:"add_action_icon",src:z},null,-1)),fs=n(()=>i("div",{class:"add_action_name"},"添加限制条件",-1)),Ls=[vs,fs],ws=n(()=>i("div",{class:"name_hint"}," 执行动作 ",-1)),Ss=n(()=>i("div",{class:"name_hint1"}," 执行对应场景设备 ",-1)),Cs={class:"action"},Is={class:"action_list"},Rs=["src"],bs={class:"action_info"},Ns={class:"action_dev_name"},ks={class:"action_exec_name"},xs=n(()=>i("div",{class:"divider"},null,-1)),ys=n(()=>i("img",{class:"add_action_icon",src:M},null,-1)),js=n(()=>i("div",{class:"add_action_name"},"添加执行动作",-1)),As=[ys,js];function Os(s,t,o,Ts,c,a){const w=O,v=A,S=y("RoomListPop"),C=J;return r(),d("div",H,[m(w,{class:"nav_bar",title:"手动场景","right-text":"保存",onClickRight:a.onClickRight,onClickLeft:a.onClickLeft},null,8,["onClickRight","onClickLeft"]),i("div",K,[Q,m(v,{class:"input",modelValue:c.scenename,"onUpdate:modelValue":t[0]||(t[0]=e=>c.scenename=e),clearable:"",placeholder:"请输入场景名称"},null,8,["modelValue"]),W,m(v,{class:"input",modelValue:c.roomName,"onUpdate:modelValue":t[1]||(t[1]=e=>c.roomName=e),onClick:a.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),X,Y,(r(!0),d(p,null,u(c.triggerList,e=>(r(),d("div",Z,[i("div",$,[i("img",{class:"action_icon",src:e.icon},null,8,ss),i("div",is,[i("div",ts,_(e.actionDevShowName),1),i("div",os,_(e.actionShowName),1)]),i("img",{class:"ic_remove",src:g,onClick:t[2]||(t[2]=f=>{a.triggerRemove(c.item)})})]),es]))),256)),i("div",{class:"add_action",onClick:t[3]||(t[3]=(...e)=>a.addTrigger&&a.addTrigger(...e))},as),ls,ds,(r(!0),d(p,null,u(c.limitList,e=>(r(),d("div",rs,[i("div",_s,[i("img",{class:"action_icon",src:e.icon},null,8,ms),i("div",hs,[i("div",ps,_(e.actionDevShowName),1),i("div",us,_(e.actionShowName),1)]),i("img",{class:"ic_remove",src:g,onClick:t[4]||(t[4]=f=>{a.limitRemove(c.item)})})]),gs]))),256)),i("div",{class:"add_action",onClick:t[5]||(t[5]=(...e)=>a.addLimit&&a.addLimit(...e))},Ls),ws,Ss,(r(!0),d(p,null,u(c.actionList,e=>(r(),d("div",Cs,[i("div",Is,[i("img",{class:"action_icon",src:e.icon},null,8,Rs),i("div",bs,[i("div",Ns,_(e.actionDevShowName),1),i("div",ks,_(e.actionShowName),1)]),i("img",{class:"ic_remove",src:g,onClick:t[6]||(t[6]=f=>a.actionRemove(c.item))})]),xs]))),256)),i("div",{class:"add_action",onClick:t[7]||(t[7]=(...e)=>a.addAction&&a.addAction(...e))},As)]),m(C,{show:c.room_sel_show,"onUpdate:show":t[8]||(t[8]=e=>c.room_sel_show=e),position:"bottom"},{default:R(()=>[m(S,{list:c.roomList,onOnCancal:a.onRoomSelCancel,onOnConfirm:a.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),b(i("div",{class:"del_text",onClick:t[9]||(t[9]=e=>a.delScene())},"删除场景",512),[[N,c.sceneId!=null&&c.sceneId!=-1]])])}const Ds=I(G,[["render",Os],["__scopeId","data-v-b562bd29"]]);j(Ds).mount("#root");
