import{_ as I,c as d,b as m,a as s,F as p,r as u,w as R,h as b,v as N,o as r,t as _,p as k,g as x,i as y,d as j}from"./_plugin-vue_export-helper-051f66a3.js";import"./index-9d551784.js";/* empty css              *//* empty css              */import"./index-0f3161d3.js";import{F as A}from"./index-c3a7f1d1.js";import{_ as O}from"./nav-bar-a1dce73c.js";import{R as D}from"./room-component-ebb7a639.js";import{S as T}from"./scene-action-light-component-f627c98b.js";import{v as E,q as P,y as U,z as V,r as B}from"./api-c3130a22.js";import{p as L,a as h}from"./scene-cfbe032f.js";import{g as F}from"./urlparse-f25d0f77.js";import{_ as g,a as M}from"./ic_scene_add_action-3488ce3c.js";import{a as l}from"./function-call-753dd7bf.js";import{P as J}from"./index-1c58f097.js";import"./use-route-666d481f.js";import"./use-id-ae36fcd7.js";import"./use-expose-1ff20361.js";import"./index-38a4c887.js";import"./index-bf853e3e.js";import"./index-d8032618.js";/* empty css              */import"./index-2954d1b3.js";import"./use-touch-8855ff1b.js";import"./index-6ceb7711.js";import"./index-1c77c952.js";import"./dev-image-f6fc399c.js";import"./ic_scene1-0f866639.js";const q=""+new URL("ic_scene_add_trigger-2d8976e0.svg",import.meta.url).href,z=""+new URL("ic_scene_add_limit-64529cf8.svg",import.meta.url).href;const G={components:{SceneActionLight:T,RoomListPop:D},data(){return{scenename:"",item:null,value:0,room_sel_show:!1,roomList:[],roomName:"",roomId:-1,actionList:[],triggerList:[],limitList:[],sceneId:-1}},mounted(){this.getUrlParams(),window.__eventBus.on("addDevAction",i=>{i=L(i),this.actionList.push(i)}),window.__eventBus.on("addTriggerSchedule",i=>{i=h(i),this.triggerList.push(i)}),window.__eventBus.on("addLimitSchedule",i=>{if(this.limitList.length>0){l("只能选择一个时间限制");return}i=h(i),this.limitList.push(i)}),window.__eventBus.on("addTrigger",i=>{i=h(i),this.triggerList.push(i)})},methods:{delScene(){E(this.sceneId).then(i=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop()}).catch(i=>{l(i)})},getUrlParams(){let i=window.location.search;const t=F(i);console.log(t),t!=null&&"sceneId"in t&&(this.sceneId=t.sceneId,console.log(this.sceneId),this.sceneId!=null&&this.sceneId!=-1&&this.getSceneDetail())},getSceneDetail(){P(this.sceneId).then(i=>{if(i.data.sceneList.length>0){this.scenename=i.data.sceneList[0].sceneName,this.roomName=i.data.sceneList[0].roomName,this.roomId=i.data.sceneList[0].roomId,this.actionList=i.data.sceneList[0].actionList,this.actionList.forEach(o=>{o.extension=JSON.parse(o.extension),o=L(o)}),this.triggerList=i.data.sceneList[0].triggerList;let t=null;this.triggerList.forEach(o=>{o=h(o),o.triggerType=="Cycle"&&(this.limitList.push(o),t=o)}),t!=null&&this.triggerList.splice(this.triggerList.indexOf(t),1)}else l(i.info)}).catch(i=>console.log(i))},onClickLeft(){window.__jsb.pop()},onClickRight(){if(this.scenename==""){l("请输入情景名称");return}if(this.roomId==-1){l("请选择房间");return}if(this.triggerList==null||this.triggerList.length==0){l("最少要包含一个触发条件");return}if(this.actionList==null||this.actionList.length==0){l("最少要包含一个动作");return}this.actionList.forEach(o=>{o.extension!=null&&o.extension!="null"&&(o.extension=JSON.stringify(o.extension))});let i=null,t=null;this.triggerList.forEach(o=>{o.triggerType=="Schedule"&&(i=o)}),this.limitList.length>0&&(t=this.limitList[0],this.triggerList.push(t)),this.sceneId==-1?U(this.scenename,"Normal",this.roomId,i,t,this.triggerList,this.actionList).then(o=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o)):V(this.sceneId,this.scenename,"Normal",this.roomId,i,t,this.triggerList,this.actionList).then(o=>{window.__jsb.forwardEvent("reload","","scene-auto","scene-list"),window.__jsb.pop(),console.log("addManualScene",addManualScene)}).catch(o=>console.log(o))},selRoom(){this.room_sel_show=!0,B().then(i=>{i.code==200?this.roomList=i.data.roomList:l(i.info)})},onRoomSelCancel(){this.room_sel_show=!1},onRoomSelConfirm(i){console.log("onRoomSelConfirm",i),this.roomName=i.roomName,this.roomId=i.roomId,this.room_sel_show=!1},addAction(){window.__jsb.push({route:"scene-action-type",params:{type:"auto"}})},addTrigger(){window.__jsb.push({route:"scene-trigger-type"})},addLimit(){window.__jsb.push({route:"scene-limit-type"})},actionRemove(i){this.actionList.splice(this.actionList.indexOf(i),1)},triggerRemove(i){this.triggerList.splice(this.actionList.indexOf(i),1)},limitRemove(i){this.limitList.splice(this.actionList.indexOf(i),1)}}},n=i=>(k("data-v-b562bd29"),i=i(),x(),i),H={class:"home"},K={class:"dev_content"},Q=n(()=>s("div",{class:"name_hint"}," 场景名称 ",-1)),W=n(()=>s("div",{class:"name_hint"}," 房间 ",-1)),X=n(()=>s("div",{class:"name_hint"}," 触发条件 ",-1)),Y=n(()=>s("div",{class:"name_hint1"}," 满足以下任一条件时触发 ",-1)),Z={class:"action"},$={class:"action_list"},ii=["src"],si={class:"action_info"},ti={class:"action_dev_name"},oi={class:"action_exec_name"},ei=n(()=>s("div",{class:"divider"},null,-1)),ni=n(()=>s("img",{class:"add_action_icon",src:q},null,-1)),ci=n(()=>s("div",{class:"add_action_name"},"添加触发条件",-1)),ai=[ni,ci],li=n(()=>s("div",{class:"name_hint"}," 限制条件 ",-1)),di=n(()=>s("div",{class:"name_hint1"}," 满足以下任一条件时不触发 ",-1)),ri={class:"action"},_i={class:"action_list"},mi=["src"],hi={class:"action_info"},pi={class:"action_dev_name"},ui={class:"action_exec_name"},gi=n(()=>s("div",{class:"divider"},null,-1)),vi=n(()=>s("img",{class:"add_action_icon",src:z},null,-1)),fi=n(()=>s("div",{class:"add_action_name"},"添加限制条件",-1)),Li=[vi,fi],wi=n(()=>s("div",{class:"name_hint"}," 执行动作 ",-1)),Si=n(()=>s("div",{class:"name_hint1"}," 执行对应场景设备 ",-1)),Ci={class:"action"},Ii={class:"action_list"},Ri=["src"],bi={class:"action_info"},Ni={class:"action_dev_name"},ki={class:"action_exec_name"},xi=n(()=>s("div",{class:"divider"},null,-1)),yi=n(()=>s("img",{class:"add_action_icon",src:M},null,-1)),ji=n(()=>s("div",{class:"add_action_name"},"添加执行动作",-1)),Ai=[yi,ji];function Oi(i,t,o,Ti,c,a){const w=O,v=A,S=y("RoomListPop"),C=J;return r(),d("div",H,[m(w,{class:"nav_bar",title:"手动场景","right-text":"保存",onClickRight:a.onClickRight,onClickLeft:a.onClickLeft},null,8,["onClickRight","onClickLeft"]),s("div",K,[Q,m(v,{class:"input",modelValue:c.scenename,"onUpdate:modelValue":t[0]||(t[0]=e=>c.scenename=e),clearable:"",placeholder:"请输入场景名称"},null,8,["modelValue"]),W,m(v,{class:"input",modelValue:c.roomName,"onUpdate:modelValue":t[1]||(t[1]=e=>c.roomName=e),onClick:a.selRoom,"right-icon":"arrow ",readonly:"",placeholder:"请选择房间"},null,8,["modelValue","onClick"]),X,Y,(r(!0),d(p,null,u(c.triggerList,e=>(r(),d("div",Z,[s("div",$,[s("img",{class:"action_icon",src:e.icon},null,8,ii),s("div",si,[s("div",ti,_(e.actionDevShowName),1),s("div",oi,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:g,onClick:t[2]||(t[2]=f=>{a.triggerRemove(c.item)})})]),ei]))),256)),s("div",{class:"add_action",onClick:t[3]||(t[3]=(...e)=>a.addTrigger&&a.addTrigger(...e))},ai),li,di,(r(!0),d(p,null,u(c.limitList,e=>(r(),d("div",ri,[s("div",_i,[s("img",{class:"action_icon",src:e.icon},null,8,mi),s("div",hi,[s("div",pi,_(e.actionDevShowName),1),s("div",ui,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:g,onClick:t[4]||(t[4]=f=>{a.limitRemove(c.item)})})]),gi]))),256)),s("div",{class:"add_action",onClick:t[5]||(t[5]=(...e)=>a.addLimit&&a.addLimit(...e))},Li),wi,Si,(r(!0),d(p,null,u(c.actionList,e=>(r(),d("div",Ci,[s("div",Ii,[s("img",{class:"action_icon",src:e.icon},null,8,Ri),s("div",bi,[s("div",Ni,_(e.actionDevShowName),1),s("div",ki,_(e.actionShowName),1)]),s("img",{class:"ic_remove",src:g,onClick:t[6]||(t[6]=f=>a.actionRemove(c.item))})]),xi]))),256)),s("div",{class:"add_action",onClick:t[7]||(t[7]=(...e)=>a.addAction&&a.addAction(...e))},Ai)]),m(C,{show:c.room_sel_show,"onUpdate:show":t[8]||(t[8]=e=>c.room_sel_show=e),position:"bottom"},{default:R(()=>[m(S,{list:c.roomList,onOnCancal:a.onRoomSelCancel,onOnConfirm:a.onRoomSelConfirm},null,8,["list","onOnCancal","onOnConfirm"])]),_:1},8,["show"]),b(s("div",{class:"del_text",onClick:t[9]||(t[9]=e=>a.delScene())},"删除场景",512),[[N,c.sceneId!=null&&c.sceneId!=-1]])])}const Di=I(G,[["render",Oi],["__scopeId","data-v-b562bd29"]]);j(Di).mount("#root");
