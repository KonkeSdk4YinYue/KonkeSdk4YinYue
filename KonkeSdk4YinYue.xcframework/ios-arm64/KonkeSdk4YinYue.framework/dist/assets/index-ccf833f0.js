import{m as L,q as B,Z as R,s as _,aa as O,u as F,A as p,B as Y,a0 as V,a as c,v as W,Y as X,z,R as J,y as D,S as $,x as k,N as ee,G as oe,Q as te,ad as ae,I as se,ae as ie,af as ne,U as le,w as ce}from"./_plugin-vue_export-helper-ae94e834.js";import{u as re}from"./use-expose-833097fe.js";import{a as me,S as ue}from"./index-015663ed.js";import{P as ve}from"./index-c49f2c8f.js";import{u as de}from"./use-touch-b8f7fc8d.js";import{I as ge}from"./index-9cad779b.js";import{L as fe}from"./index-5198b2b7.js";import{L as he,H as we}from"./constant-eb256a74.js";import{c as Pe}from"./interceptor-c174082f.js";const A=t=>Math.sqrt((t[0].clientX-t[1].clientX)**2+(t[0].clientY-t[1].clientY)**2),E=L("image-preview")[1];var Se=B({props:{src:String,show:Boolean,active:Number,minZoom:R(_),maxZoom:R(_),rootWidth:R(Number),rootHeight:R(Number),disableZoom:Boolean},emits:["scale","close","longPress"],setup(t,{emit:l,slots:u}){const e=O({scale:1,moveX:0,moveY:0,moving:!1,zooming:!1,imageRatio:0,displayWidth:0,displayHeight:0}),s=de(),w=F(),I=p(()=>{const{rootWidth:o,rootHeight:i}=t,n=i/o;return e.imageRatio>n}),C=p(()=>{const{scale:o,moveX:i,moveY:n,moving:g,zooming:f}=e,H={transitionDuration:f||g?"0s":".3s"};if(o!==1){const K=i/o,Q=n/o;H.transform=`scale(${o}, ${o}) translate(${K}px, ${Q}px)`}return H}),r=p(()=>{if(e.imageRatio){const{rootWidth:o,rootHeight:i}=t,n=I.value?i/e.imageRatio:o;return Math.max(0,(e.scale*n-o)/2)}return 0}),v=p(()=>{if(e.imageRatio){const{rootWidth:o,rootHeight:i}=t,n=I.value?i:o*e.imageRatio;return Math.max(0,(e.scale*n-i)/2)}return 0}),T=o=>{o=X(o,+t.minZoom,+t.maxZoom+1),o!==e.scale&&(e.scale=o,l("scale",{scale:o,index:t.active}))},b=()=>{T(1),e.moveX=0,e.moveY=0},M=()=>{const o=e.scale>1?1:2;T(o),e.moveX=0,e.moveY=0};let h,P,S,y,Z,a,d,m=!1;const q=o=>{const{touches:i}=o;if(h=i.length,h===2&&t.disableZoom)return;const{offsetX:n}=s;s.start(o),P=e.moveX,S=e.moveY,d=Date.now(),m=!1,e.moving=h===1&&e.scale!==1,e.zooming=h===2&&!n.value,e.zooming&&(y=e.scale,Z=A(o.touches))},j=o=>{const{touches:i}=o;if(s.move(o),e.moving){const{deltaX:n,deltaY:g}=s,f=n.value+P,H=g.value+S;if((f>r.value||f<-r.value)&&!m&&s.isHorizontal()){e.moving=!1;return}m=!0,W(o,!0),e.moveX=X(f,-r.value,r.value),e.moveY=X(H,-v.value,v.value)}if(e.zooming&&(W(o,!0),i.length===2)){const n=A(i),g=y*n/Z;T(g)}},G=()=>{if(h>1)return;const{offsetX:o,offsetY:i}=s,n=Date.now()-d,g=250,f=5;o.value<f&&i.value<f&&(n<g?a?(clearTimeout(a),a=null,M()):a=setTimeout(()=>{l("close"),a=null},g):n>he&&l("longPress"))},N=o=>{let i=!1;if((e.moving||e.zooming)&&(i=!0,e.moving&&P===e.moveX&&S===e.moveY&&(i=!1),!o.touches.length)){e.zooming&&(e.moveX=X(e.moveX,-r.value,r.value),e.moveY=X(e.moveY,-v.value,v.value),e.zooming=!1),e.moving=!1,P=0,S=0,y=1,e.scale<1&&b();const n=+t.maxZoom;e.scale>n&&(e.scale=n)}W(o,i),G(),s.reset()},U=o=>{const{naturalWidth:i,naturalHeight:n}=o.target;e.imageRatio=n/i};return Y(()=>t.active,b),Y(()=>t.show,o=>{o||b()}),V("touchmove",j,{target:p(()=>{var o;return(o=w.value)==null?void 0:o.$el})}),()=>{const o={loading:()=>c(fe,{type:"spinner"},null)};return c(me,{ref:w,class:E("swipe-item"),onTouchstartPassive:q,onTouchend:N,onTouchcancel:N},{default:()=>[u.image?c("div",{class:E("image-wrap")},[u.image({src:t.src})]):c(ge,{src:t.src,fit:"contain",class:E("image",{vertical:I.value}),style:C.value,onLoad:U},o)]})}}});const[xe,x]=L("image-preview"),Ie=["show","teleport","transition","overlayStyle","closeOnPopstate"],Te={show:Boolean,loop:z,images:J(),minZoom:D(1/3),maxZoom:D(3),overlay:z,closeable:Boolean,showIndex:z,className:$,closeIcon:k("clear"),transition:String,beforeClose:Function,overlayClass:$,overlayStyle:Object,swipeDuration:D(300),startPosition:D(0),showIndicators:Boolean,closeOnPopstate:z,closeIconPosition:k("top-right"),teleport:[String,Object]};var be=B({name:xe,props:Te,emits:["scale","close","closed","change","longPress","update:show"],setup(t,{emit:l,slots:u}){const e=F(),s=O({active:0,rootWidth:0,rootHeight:0,disableZoom:!1}),w=()=>{if(e.value){const a=ae(e.value.$el);s.rootWidth=a.width,s.rootHeight=a.height,e.value.resize()}},I=a=>l("scale",a),C=a=>l("update:show",a),r=()=>{Pe(t.beforeClose,{args:[s.active],done:()=>C(!1)})},v=a=>{a!==s.active&&(s.active=a,l("change",a))},T=()=>{if(t.showIndex)return c("div",{class:x("index")},[u.index?u.index({index:s.active}):`${s.active+1} / ${t.images.length}`])},b=()=>{if(u.cover)return c("div",{class:x("cover")},[u.cover()])},M=()=>{s.disableZoom=!0},h=()=>{s.disableZoom=!1},P=()=>c(ue,{ref:e,lazyRender:!0,loop:t.loop,class:x("swipe"),duration:t.swipeDuration,initialSwipe:t.startPosition,showIndicators:t.showIndicators,indicatorColor:"white",onChange:v,onDragEnd:h,onDragStart:M},{default:()=>[t.images.map((a,d)=>c(Se,{src:a,show:t.show,active:s.active,maxZoom:t.maxZoom,minZoom:t.minZoom,rootWidth:s.rootWidth,rootHeight:s.rootHeight,disableZoom:s.disableZoom,onScale:I,onClose:r,onLongPress:()=>l("longPress",{index:d})},{image:u.image}))]}),S=()=>{if(t.closeable)return c(se,{role:"button",name:t.closeIcon,class:[x("close-icon",t.closeIconPosition),we],onClick:r},null)},y=()=>l("closed"),Z=(a,d)=>{var m;return(m=e.value)==null?void 0:m.swipeTo(a,d)};return re({swipeTo:Z}),ee(w),Y([ie,ne],w),Y(()=>t.startPosition,a=>v(+a)),Y(()=>t.show,a=>{const{images:d,startPosition:m}=t;a?(v(+m),le(()=>{w(),Z(+m,{immediate:!0})})):l("close",{index:s.active,url:d[s.active]})}),()=>c(ve,oe({class:[x(),t.className],overlayClass:[x("overlay"),t.overlayClass],onClosed:y,"onUpdate:show":C},te(t,Ie)),{default:()=>[S(),P(),T(),b()]})}});const De=ce(be);export{De as I,be as s};
